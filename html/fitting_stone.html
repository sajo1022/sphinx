<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Documentation of the fitting stone location algorithm &mdash; Image Processing 03/2022 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation of the standard stone location algorithm" href="standard_stone.html" />
    <link rel="prev" title="Environment and necessary dependencies" href="environment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Image Processing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Environment:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment and necessary dependencies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Fitting stone:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Documentation of the fitting stone location algorithm</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Standard stone:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard_stone.html">Documentation of the standard stone location algorithm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Image Processing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Documentation of the fitting stone location algorithm</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/fitting_stone.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-image_processing_scripts.fitting_stone">
<span id="documentation-of-the-fitting-stone-location-algorithm"></span><h1>Documentation of the fitting stone location algorithm<a class="headerlink" href="#module-image_processing_scripts.fitting_stone" title="Permalink to this headline"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.find_fitting_stone">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">find_fitting_stone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intensity_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.find_fitting_stone" title="Permalink to this definition"></a></dt>
<dd><p>This is the main procedure to locate fitting stones on a pallet.
Its nessecary, that the pallet is packed in the right order and at least two of the stones
contours are visible (one corner)</p>
<p>Idea: Extract the stones height from the xml file. Determine the upper left corner in
the image (can be changed by adapting function “find_corner_contour”). This corner corresponds
to the stone corner. By calculating the orientation of one of the found contours and the stones
geometry from the xml, the stones center and orientation can be determined.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xyz_image</strong> (<em>HObject</em><em> (</em><em>image</em><em>)</em>) – 3-Channel image [[x-data], [y-data], [z-data]]</p></li>
<li><p><strong>intensity_image</strong> (<em>HObject</em><em> (</em><em>image</em><em>)</em>) – 1-Channel image [[intensity]]</p></li>
<li><p><strong>config</strong> (<em>dict</em><em>(</em><em>)</em>) – Dictionary containing [pallet_id];[stone_id];[xml_path];[visualize];[camera_height]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>hom_mats</strong> (<em>Matrix 4x4 [float]</em>) – Stone center location as homogenous matrix in millimeters/rad</p></li>
<li><p><strong>stone_xyzz</strong> (<em>[float, float, float, float]</em>) – Stone center location [x, y, z, rotz] in millimeters/rad</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.get_stone_dimensions_from_xml">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">get_stone_dimensions_from_xml</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.get_stone_dimensions_from_xml" title="Permalink to this definition"></a></dt>
<dd><p>This funtion extracts a stones dimension and location on the pallet from
the xml file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em><em>(</em><em>)</em>) – Dictionary containing [pallet_id];[stone_id];[xml_path]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>stone_geometry</strong> (<em>[[float, float, float]]</em>) – Realworld geometry of the stone in millimeters
as stated in the pallets xml file. [[x, y, z]]</p></li>
<li><p><em># Not in use yet.</em></p></li>
<li><p><strong>stone_position</strong> (<em>[[float, float, float]]</em>) – Realworld position of the stones center in millimeters
as stated in the pallets xml file. [[x, y, z]]</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.find_corner_contour">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">find_corner_contour</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stone_region</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.find_corner_contour" title="Permalink to this definition"></a></dt>
<dd><p>This function determines the most upper left corner of a region and returns both the horizontal and the vertical
contour as haclon xld object, aswell as the pixel coordinates of the stone corner.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stone_region</strong> (<em>HObject</em><em> (</em><em>regions</em><em>)</em>) – Input region that contains
the stone of interest in the
upper left corner of the image</p></li>
<li><p><strong>config</strong> (<em>dict</em><em>(</em><em>)</em>) – Only needed for visualization purposes
Assertion: conifg[“visualize”]=={‘no’, ‘result’, ‘step_by_step’, ‘debug’}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>corner_contour</strong> (<em>HObject (xld)</em>) – Contains xlds of the upper left contours in the input region</p></li>
<li><p><strong>stone_corner_px</strong> (<em>[float, float]</em>) – Pixel coordinate of the stone coordinates
[row, column]</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.calc_px_per_mm">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">calc_px_per_mm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_contour</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.calc_px_per_mm" title="Permalink to this definition"></a></dt>
<dd><p>This funcition is only for visualization purposes. It approximates
how many millimeters are in one pixel of the corner_contour. This
value depends on the distance between the corner_contour and the
cameras optical center. The value is calculated by dividing the millimeter
values of the stone_contour by its corresponding lenght in pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xyz_image</strong> (<em>HObject</em><em> (</em><em>image</em><em>)</em>) – 3-Channel image [[x-data], [y-data], [z-data]]</p></li>
<li><p><strong>corner_contour</strong> (<em>HObject</em><em> (</em><em>xld</em><em>)</em>) – Contains xlds of the upper left contours in the input region</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>mm_per_pixel</strong> – Approximated value, of how many millimeters
correspond to one pixel in the height of the
stone corner.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.calc_coordsys_for_visualization">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">calc_coordsys_for_visualization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">origin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stone_geometry</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mm_per_pixel</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.calc_coordsys_for_visualization" title="Permalink to this definition"></a></dt>
<dd><p>This function is for visualization purposes only. It calculates a coordinate system
with its origin in the stones corner and in orientation of the stone. The length of
both axis are calculated by the stones geometry and the factor mm_per_pixels of the
stone region. As the mm_per_pixel factor is only an approximation, the coordinate axis
length may differ from the stones length in the image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origin</strong> (<em>[</em><em>float</em><em>, </em><em>float</em><em>]</em>) – Pixel value in image coordinates [row, column] of the
coordinate system.</p></li>
<li><p><strong>stone_geometry</strong> (<em>[</em><em>[</em><em>float</em><em>, </em><em>float</em><em>, </em><em>float</em><em>]</em><em>]</em>) – Realworld geometry of the stone in millimeters
as stated in the pallets xml file. [[x, y, z]]</p></li>
<li><p><strong>orientation</strong> (<em>float</em>) – Radial measure of the stones rotation around its z_axis
(reference axis image column (y-image of helios2)).
Assertion: -pi/2 &lt; orientation &lt; pi/2</p></li>
<li><p><strong>mm_per_pixel</strong> (<em>float</em>) – Approximated value, of how many millimeters
correspond to one pixel in the height of the
stone corner.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>coord_sys</strong> – —
[[start_row_x_axis, start_col_x_axis, end_row_x_axis, end_col_x_axis],
[start_row_y_axis, start_col_y_axis, end_row_y_axis, end_col_y_axis]]
—
Float sequenze in format required by halcon to visualize an arrow</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>[[flaot, float, float, float], [flaot, float, float, float]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="image_processing_scripts.fitting_stone.get_orientation_longest_contour">
<span class="sig-prename descclassname"><span class="pre">image_processing_scripts.fitting_stone.</span></span><span class="sig-name descname"><span class="pre">get_orientation_longest_contour</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">corner_contour</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#image_processing_scripts.fitting_stone.get_orientation_longest_contour" title="Permalink to this definition"></a></dt>
<dd><p>This function calculates the stones orientation around its z_axis. Reference axis is the images
column (x-image of Helios2). It selects the longer of both corner_contours and fits a regression line
to it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>corner_contour</strong> (<em>HObject</em><em> (</em><em>xld</em><em>)</em>) – Contains xlds of the upper left contours in the input region</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>orientation</strong> – Radial measure of the stones rotation around its z_axis
(reference axis image column (y-image of helios2)).
Assertion: -pi/2 &lt; orientation &lt; pi/2</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="environment.html" class="btn btn-neutral float-left" title="Environment and necessary dependencies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="standard_stone.html" class="btn btn-neutral float-right" title="Documentation of the standard stone location algorithm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Max Körner, Jonathan Sautter.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>